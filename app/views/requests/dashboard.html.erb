<%= search_form_for @q, url: dashboard_requests_path, method: :get, class: "mb-15", local: true do |f| %>
  <%= f.label :status_eq, "ステータス" %>
  <%= f.select :status_eq,
    [["下書き", 0], ["承認待ち", 1], ["掲載中", 2], ["拒否", 3], ["成功", 4], ["失敗(終了)", 5], ["成功(終了)", 6]],
    { include_blank: "すべて", selected: params[:q]&.[](:status_eq) }, 
    { onchange: "this.form.submit();" } %>
<% end %>

<div class="text-center"><%= "現在依頼しているリクエストはありません" if @requests.blank? %></div>
<% @requests.each do |request| %>
  <% if request.draft? || request.submit? %>
  
    <!-- draft / submit 用 card -->
    <div class="bg-[#f0f2f4] border border-[#d9dee5] mx-auto max-w-200 rounded md:px-4 py-4 mb-6">

      <h2 class="font-bold md:text-lg text-center mb-2">
        <%= request.title %>
      </h2>

      <%= render partial: "requests/request_image", locals: {request: request} %>

      <div class="bg-white rounded p-3 mb-4 mt-4">
        <%= simple_format(request.body) %>
      </div>

      <% if request.draft? %>
      <div class="flex justify-center gap-6">
        <%= link_to "編集する",
          edit_request_path(request),
          class: "inline-block bg-gray-500 py-2 text-white px-8 rounded" %>

        <%= link_to "送信する",
          submit_request_status_path(request),
          data: { turbo_method: :patch },
          class: "inline-block bg-blue-500 py-2 text-white px-8 rounded" %>
      </div>
    <% end %>
    </div>

  <% else %>
    <!-- それ以外（詳細ページに遷移させたい card） -->
    <div class="bg-[#f0f2f4] border border-[#d9dee5] mx-auto max-w-200 rounded md:px-4 mb-6 py-4">

      <%= link_to request do %>
        <h2 class="font-bold md:text-lg text-center mb-4">
          <%= request.title %>
        </h2>

        <%= render partial: "requests/request_image", locals: {request: request} %>
        <div class="bg-white rounded p-3 mt-4">
         <%= simple_format(request.body) %>
        </div>
      <% end %>
    </div>
  <% end %>

<% end %>
